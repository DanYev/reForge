

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>reforge.rfgmath package &mdash; reForge 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=dc75d08a" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=01f34227"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="reforge.mdsystem package" href="reforge.mdsystem.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            reForge
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="why.html">Why use reForge?</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto_examples/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">reForge API</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="reforge.html">reforge package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="reforge.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="reforge.forge.html">reforge.forge package</a></li>
<li class="toctree-l4"><a class="reference internal" href="reforge.martini.html">reforge.martini package</a></li>
<li class="toctree-l4"><a class="reference internal" href="reforge.mdsystem.html">reforge.mdsystem package</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">reforge.rfgmath package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reforge.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="reforge.html#module-reforge.cli">reforge.cli module</a></li>
<li class="toctree-l3"><a class="reference internal" href="reforge.html#module-reforge.io">reforge.io module</a></li>
<li class="toctree-l3"><a class="reference internal" href="reforge.html#module-reforge.itpio">reforge.itpio module</a></li>
<li class="toctree-l3"><a class="reference internal" href="reforge.html#module-reforge.mdm">reforge.mdm module</a></li>
<li class="toctree-l3"><a class="reference internal" href="reforge.html#module-reforge.pdbtools">reforge.pdbtools module</a></li>
<li class="toctree-l3"><a class="reference internal" href="reforge.html#module-reforge.plotting">reforge.plotting module</a></li>
<li class="toctree-l3"><a class="reference internal" href="reforge.html#module-reforge.utils">reforge.utils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="reforge.html#module-reforge">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">reForge</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">reForge API</a></li>
          <li class="breadcrumb-item"><a href="reforge.html">reforge package</a></li>
      <li class="breadcrumb-item active">reforge.rfgmath package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/reforge.rfgmath.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="reforge-rfgmath-package">
<h1>reforge.rfgmath package<a class="headerlink" href="#reforge-rfgmath-package" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-reforge.rfgmath.legacy">
<span id="reforge-rfgmath-legacy-module"></span><h2>reforge.rfgmath.legacy module<a class="headerlink" href="#module-reforge.rfgmath.legacy" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.legacy.calcperturbMat">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.legacy.</span></span><span class="sig-name descname"><span class="pre">calcperturbMat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">invHrs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resnum</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/legacy.html#calcperturbMat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.legacy.calcperturbMat" title="Link to this definition"></a></dt>
<dd><p>Legavy perturbation matrix for dfi calculation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.legacy.calculate_hessian">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.legacy.</span></span><span class="sig-name descname"><span class="pre">calculate_hessian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff=12</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spring_constant=1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dd=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype=&lt;class</span> <span class="pre">'numpy.float64'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/legacy.html#calculate_hessian"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.legacy.calculate_hessian" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.legacy.perturbation_matrix_old">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.legacy.</span></span><span class="sig-name descname"><span class="pre">perturbation_matrix_old</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">covariance_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype=&lt;class</span> <span class="pre">'numpy.float64'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/legacy.html#perturbation_matrix_old"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.legacy.perturbation_matrix_old" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.legacy.perturbation_matrix_cpu">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.legacy.</span></span><span class="sig-name descname"><span class="pre">perturbation_matrix_cpu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">covariance_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype=&lt;class</span> <span class="pre">'numpy.float64'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/legacy.html#perturbation_matrix_cpu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.legacy.perturbation_matrix_cpu" title="Link to this definition"></a></dt>
<dd><p>Calculates perturbation matrix from a covariance matrix or a hessian on
CPU The result is normalized such that the total sum of the matrix elements
is equal to 1.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.legacy.td_perturbation_matrix_cpu">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.legacy.</span></span><span class="sig-name descname"><span class="pre">td_perturbation_matrix_cpu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ccf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype=&lt;class</span> <span class="pre">'numpy.float64'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/legacy.html#td_perturbation_matrix_cpu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.legacy.td_perturbation_matrix_cpu" title="Link to this definition"></a></dt>
<dd><p>Calculates perturbation matrix from a covariance matrix or a hessian on
CPU The result is normalized such that the total sum of the matrix elements
is equal to 1.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.legacy.pad_matrix_if_odd">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.legacy.</span></span><span class="sig-name descname"><span class="pre">pad_matrix_if_odd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">M</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/legacy.html#pad_matrix_if_odd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.legacy.pad_matrix_if_odd" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.legacy.split_matrix">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.legacy.</span></span><span class="sig-name descname"><span class="pre">split_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">M</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/legacy.html#split_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.legacy.split_matrix" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.legacy.invert_hessian">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.legacy.</span></span><span class="sig-name descname"><span class="pre">invert_hessian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hessian</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol_conv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/legacy.html#invert_hessian"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.legacy.invert_hessian" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.legacy.invert_matrix_gpu">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.legacy.</span></span><span class="sig-name descname"><span class="pre">invert_matrix_gpu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k_singular</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">DENSE_NOT_SPARSE</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/legacy.html#invert_matrix_gpu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.legacy.invert_matrix_gpu" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.legacy.invert_symm_block_matrix_gpu">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.legacy.</span></span><span class="sig-name descname"><span class="pre">invert_symm_block_matrix_gpu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/legacy.html#invert_symm_block_matrix_gpu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.legacy.invert_symm_block_matrix_gpu" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-reforge.rfgmath.rcmath">
<span id="reforge-rfgmath-rcmath-module"></span><h2>reforge.rfgmath.rcmath module<a class="headerlink" href="#module-reforge.rfgmath.rcmath" title="Link to this heading"></a></h2>
<p>Cython Math</p>
<dl>
<dt>Description:</dt><dd><p>This module contains internal routines for performing optimized mathematical
operations. It includes functions for calculating position-position Hessian matrices
and perturbation matrices derived from coordinate and covariance data.
The computations are accelerated using Cython.</p>
<p>Note: This module is intended for internal use only within the reForge workflow.</p>
</dd>
<dt>Usage Example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">rcmath</span><span class="w"> </span><span class="kn">import</span> <span class="n">_calculate_hessian</span><span class="p">,</span> <span class="n">_hessian</span><span class="p">,</span> <span class="n">_perturbation_matrix</span><span class="p">,</span> <span class="n">_td_perturbation_matrix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generate random coordinate data for residues</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hessian2</span> <span class="o">=</span> <span class="n">_hessian</span><span class="p">(</span><span class="n">vecs</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">spring_constant</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">dd</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compute perturbation matrix from a covariance matrix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pert_matrix</span> <span class="o">=</span> <span class="n">_perturbation_matrix</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compute block-wise perturbation matrix with normalization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">td_pert_matrix</span> <span class="o">=</span> <span class="n">_td_perturbation_matrix</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Requirements:</dt><dd><ul class="simple">
<li><p>Python 3.x</p></li>
<li><p>NumPy</p></li>
<li><p>Cython</p></li>
<li><p>reForge utilities (timeit, memprofit)</p></li>
</ul>
</dd>
</dl>
<p>Author: Your Name
Date: YYYY-MM-DD</p>
<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rcmath.calculate_hessian">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rcmath.</span></span><span class="sig-name descname"><span class="pre">calculate_hessian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spring_constant</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#reforge.rfgmath.rcmath.calculate_hessian" title="Link to this definition"></a></dt>
<dd><p>Calculate the position-position Hessian matrix based on individual coordinate arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resnum</strong> (<em>int</em>) – Number of residues (atoms).</p></li>
<li><p><strong>x</strong> (<em>ndarray of double, 1D</em>) – Array of x coordinates.</p></li>
<li><p><strong>y</strong> (<em>ndarray of double, 1D</em>) – Array of y coordinates.</p></li>
<li><p><strong>z</strong> (<em>ndarray of double, 1D</em>) – Array of z coordinates.</p></li>
<li><p><strong>cutoff</strong> (<em>double, optional</em>) – Distance cutoff threshold. Interactions beyond this distance are ignored (default is 1.2).</p></li>
<li><p><strong>spring_constant</strong> (<em>double, optional</em>) – Base spring constant used in the calculation (default is 1000).</p></li>
<li><p><strong>dd</strong> (<em>int, optional</em>) – Exponent modifier applied to the inverse distance factor (default is 0).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hessian</strong> – Hessian matrix of shape (3*resnum, 3*resnum) representing the second derivatives
of the system energy with respect to positions.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray of double, 2D</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rcmath.covmat">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rcmath.</span></span><span class="sig-name descname"><span class="pre">covmat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#reforge.rfgmath.rcmath.covmat" title="Link to this definition"></a></dt>
<dd><p>Naive mimicing of:</p>
<blockquote>
<div><p>covmat = np.cov(centered_positions, rowvar=True, dtype=np.float64)</p>
</div></blockquote>
<p>Much slower, as expected.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rcmath.hessian">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rcmath.</span></span><span class="sig-name descname"><span class="pre">hessian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spring_constant</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#reforge.rfgmath.rcmath.hessian" title="Link to this definition"></a></dt>
<dd><p>Calculate the position-position Hessian matrix from a coordinate matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vec</strong> (<em>ndarray of double, 2D</em>) – A coordinate matrix where each residue’s coordinates are provided.
Note: The function computes n = vec.shape[0] // 3; thus, vec.shape[0]
should be a multiple of 3. Each residue is expected to have three entries
corresponding to its x, y, and z coordinates.</p></li>
<li><p><strong>cutoff</strong> (<em>double, optional</em>) – Distance cutoff threshold. Interactions beyond this distance are ignored (default is 1.2).</p></li>
<li><p><strong>spring_constant</strong> (<em>double, optional</em>) – Base spring constant used in the calculation (default is 1000).</p></li>
<li><p><strong>dd</strong> (<em>int, optional</em>) – Exponent modifier applied to the inverse distance factor (default is 0).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hessian</strong> – Hessian matrix of shape (3*n, 3*n) representing the second derivatives of the system energy,
where n is derived from the input coordinate matrix.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray of double, 2D</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rcmath.pcovmat">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rcmath.</span></span><span class="sig-name descname"><span class="pre">pcovmat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#reforge.rfgmath.rcmath.pcovmat" title="Link to this definition"></a></dt>
<dd><p>Parallel computation of covariance matrix using OpenMP (via prange).
Assumes X is already centered (mean subtracted).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rcmath.perturbation_matrix">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rcmath.</span></span><span class="sig-name descname"><span class="pre">perturbation_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">covariance_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#reforge.rfgmath.rcmath.perturbation_matrix" title="Link to this definition"></a></dt>
<dd><p>Compute a perturbation matrix from a covariance matrix. Same as the old one but no need
to specify resnum and works with rectangular matrices</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>covariance_matrix</strong> (<em>ndarray of double, 2D</em>) – A covariance matrix computed from positional data with shape (3*m, 3*n), where m and n
are the numbers of residues in two systems.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>perturbation_matrix</strong> – A normalized perturbation matrix of shape (m, n). Each element represents the aggregated
perturbation computed from the directional components of the corresponding 3x3 block.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray of double, 2D</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rcmath.perturbation_matrix_iso">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rcmath.</span></span><span class="sig-name descname"><span class="pre">perturbation_matrix_iso</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ccf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#reforge.rfgmath.rcmath.perturbation_matrix_iso" title="Link to this definition"></a></dt>
<dd><p>Calculate the perturbation matrix from a covariance (or Hessian) matrix using block-wise norms.</p>
<p>The input covariance matrix ‘ccf’ is expected to have shape (3*m, 3*n). For each block (i,j),
the perturbation value is computed as the square root of the sum of the squares of the corresponding
3x3 block elements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ccf</strong> (<em>ndarray of double, 2D</em>) – Input covariance matrix with shape (3*m, 3*n).</p></li>
<li><p><strong>normalize</strong> (<em>bool, optional</em>) – If True, the output perturbation matrix is normalized so that the total sum of its elements equals 1
(default is True).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>perturbation_matrix</strong> – An (m, n) matrix of perturbation values computed from the blocks of ccf.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray of double, 2D</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rcmath.perturbation_matrix_iso_par">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rcmath.</span></span><span class="sig-name descname"><span class="pre">perturbation_matrix_iso_par</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ccf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#reforge.rfgmath.rcmath.perturbation_matrix_iso_par" title="Link to this definition"></a></dt>
<dd><p>Parallel computation of perturbation matrix using OpenMP.
Calculate the perturbation matrix from a covariance (or Hessian) matrix using block-wise norms.</p>
<p>The input covariance matrix ‘ccf’ is expected to have shape (3*m, 3*n). For each block (i,j),
the perturbation value is computed as the square root of the sum of the squares of the corresponding
3x3 block elements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ccf</strong> (<em>ndarray of double, 2D</em>) – Input covariance matrix with shape (3*m, 3*n).</p></li>
<li><p><strong>normalize</strong> (<em>bool, optional</em>) – If True, the output perturbation matrix is normalized so that the total sum of its elements equals 1
(default is True).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>perturbation_matrix</strong> – An (m, n) matrix of perturbation values computed from the blocks of ccf.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray of double, 2D</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rcmath.perturbation_matrix_old">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rcmath.</span></span><span class="sig-name descname"><span class="pre">perturbation_matrix_old</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">covariance_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resnum</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#reforge.rfgmath.rcmath.perturbation_matrix_old" title="Link to this definition"></a></dt>
<dd><p>Compute a perturbation matrix from a covariance matrix using an older method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>covariance_matrix</strong> (<em>ndarray of double, 2D</em>) – A covariance matrix of shape (3*resnum, 3*resnum) computed from position data.</p></li>
<li><p><strong>resnum</strong> (<em>int</em>) – Number of residues (atoms).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>perturbation_matrix</strong> – A normalized perturbation matrix of shape (resnum, resnum), where each element
represents the cumulative perturbation contribution from directional projections.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray of double, 2D</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rcmath.perturbation_matrix_par">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rcmath.</span></span><span class="sig-name descname"><span class="pre">perturbation_matrix_par</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">covariance_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#reforge.rfgmath.rcmath.perturbation_matrix_par" title="Link to this definition"></a></dt>
<dd><p>Compute a perturbation matrix from a covariance matrix. Same as the old one but no need
to specify resnum and works with rectangular matrices</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>covariance_matrix</strong> (<em>ndarray of double, 2D</em>) – A covariance matrix computed from positional data with shape (3*m, 3*n), where m and n
are the numbers of residues in two systems.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>perturbation_matrix</strong> – A normalized perturbation matrix of shape (m, n). Each element represents the aggregated
perturbation computed from the directional components of the corresponding 3x3 block.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray of double, 2D</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rcmath.td_perturbation_matrix">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rcmath.</span></span><span class="sig-name descname"><span class="pre">td_perturbation_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ccf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#reforge.rfgmath.rcmath.td_perturbation_matrix" title="Link to this definition"></a></dt>
<dd><p>Calculate the time-dependent perturbation matrix from a td-correlation matrix using block-wise norms.</p>
<p>The input covariance matrix ‘ccf’ is expected to have shape (3*m, 3*n, nt). For each block (i,j, it),
the perturbation value is computed as the square root of the sum of the squares of the corresponding
3x3 block elements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ccf</strong> (<em>ndarray of double, 3D</em>) – Input covariance matrix with shape (3*m, 3*n, nt).</p></li>
<li><p><strong>normalize</strong> (<em>bool, optional</em>) – If True, the output perturbation matrix is normalized so that the total sum of its elements equals 1
(default is True).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>perturbation_matrix</strong> – An (m, n, nt) matrix of perturbation values computed from the blocks of ccf.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray of double, 3D</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-reforge.rfgmath.rpykernels">
<span id="reforge-rfgmath-rpykernels-module"></span><h2>reforge.rfgmath.rpykernels module<a class="headerlink" href="#module-reforge.rfgmath.rpykernels" title="Link to this heading"></a></h2>
<p>CUDA kernels for CuPy</p>
<dl>
<dt>Description:</dt><dd><p>This module contains CUDA kernel versions of internal routines for performing optimized mathematical
operations. It includes functions for calculating position-position Hessian matrices and perturbation
matrices derived from coordinate and covariance data, accelerated using CUDA. The computations are
implemented as CUDA kernels and are intended for internal use within the reForge workflow.</p>
</dd>
<dt>Usage Example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">cupy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">rcmath_cuda</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_hessian_cuda</span><span class="p">,</span> <span class="n">hessian_cuda</span><span class="p">,</span> <span class="n">perturbation_matrix_cuda</span><span class="p">,</span> <span class="n">td_perturbation_matrix_cuda</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create random coordinate data on the GPU:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hess</span> <span class="o">=</span> <span class="n">calculate_hessian_cuda</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Alternatively, if the coordinates are stored in an (n x 3) array:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vec</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hess2</span> <span class="o">=</span> <span class="n">hessian_cuda</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compute a perturbation matrix from a covariance matrix:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pert</span> <span class="o">=</span> <span class="n">perturbation_matrix_cuda</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compute a block-wise perturbation matrix:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">td_pert</span> <span class="o">=</span> <span class="n">td_perturbation_matrix_cuda</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Requirements:</dt><dd><ul class="simple">
<li><p>Python 3.x</p></li>
<li><p>NumPy</p></li>
<li><p>CuPy</p></li>
<li><p>reForge utilities (timeit, memprofit)</p></li>
</ul>
</dd>
</dl>
<p>Author: Your Name
Date: YYYY-MM-DD</p>
<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpykernels.hessian_cuda">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpykernels.</span></span><span class="sig-name descname"><span class="pre">hessian_cuda</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spring_constant</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpykernels.html#hessian_cuda"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpykernels.hessian_cuda" title="Link to this definition"></a></dt>
<dd><p>CUDA version of _hessian.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vec</strong> (<em>cupy.ndarray</em>) – A coordinate matrix of shape (n, 3) with type float64.</p></li>
<li><p><strong>cutoff</strong> (<em>float, optional</em>) – Distance cutoff.</p></li>
<li><p><strong>spring_constant</strong> (<em>float, optional</em>) – Base spring constant.</p></li>
<li><p><strong>dd</strong> (<em>int, optional</em>) – Exponent modifier.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Hessian matrix of shape (3*n, 3*n) as a cupy array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>cupy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpykernels.perturbation_matrix_cuda">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpykernels.</span></span><span class="sig-name descname"><span class="pre">perturbation_matrix_cuda</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">covar</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpykernels.html#perturbation_matrix_cuda"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpykernels.perturbation_matrix_cuda" title="Link to this definition"></a></dt>
<dd><p>CUDA version of _perturbation_matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>covar</strong> (<em>cupy.ndarray</em>) – Covariance matrix of shape (3*m, 3*n) with type float64.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Perturbation matrix of shape (m, n) (normalization should be applied separately if needed).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>cupy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpykernels.td_perturbation_matrix_cuda">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpykernels.</span></span><span class="sig-name descname"><span class="pre">td_perturbation_matrix_cuda</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ccf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpykernels.html#td_perturbation_matrix_cuda"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpykernels.td_perturbation_matrix_cuda" title="Link to this definition"></a></dt>
<dd><p>CUDA version of _td_perturbation_matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ccf</strong> (<em>cupy.ndarray</em>) – Covariance (or Hessian) matrix of shape (3*m, 3*n) with type float64.</p></li>
<li><p><strong>normalize</strong> (<em>bool, optional</em>) – If True, the output matrix is normalized so that the total sum equals 1.
(Normalization is performed on the CPU after kernel execution.)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Perturbation matrix of shape (m, n).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>cupy.ndarray</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-reforge.rfgmath.rpymath">
<span id="reforge-rfgmath-rpymath-module"></span><h2>reforge.rfgmath.rpymath module<a class="headerlink" href="#module-reforge.rfgmath.rpymath" title="Link to this heading"></a></h2>
<p>Python math functions</p>
<dl>
<dt>Description:</dt><dd><p>This module contains internal routines for performing various mathematical
and signal processing operations required in our workflow. It includes FFT‐based
correlation computations (serial, parallel, and GPU versions), covariance matrix
calculation, dynamic coupling and flexibility index evaluations, sparse matrix
inversion on both CPU and GPU, and additional helper functions such as percentile
computation and FFT‐based convolution.</p>
<p>Note: This module is intended for internal use only.</p>
</dd>
<dt>Usage Example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">rpymath</span><span class="w"> </span><span class="kn">import</span> <span class="n">_sfft_ccf</span><span class="p">,</span> <span class="n">fft_ccf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generate random signals</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compute serial FFT‐based correlation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">corr</span> <span class="o">=</span> <span class="n">_sfft_ccf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ntmax</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Or use the unified FFT correlation wrapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">corr</span> <span class="o">=</span> <span class="n">fft_ccf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;serial&#39;</span><span class="p">,</span> <span class="n">ntmax</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Requirements:</dt><dd><ul class="simple">
<li><p>Python 3.x</p></li>
<li><p>NumPy</p></li>
<li><p>SciPy</p></li>
<li><p>CuPy (for GPU-based functions)</p></li>
<li><p>joblib (for parallel processing)</p></li>
<li><p>MDAnalysis (if required elsewhere)</p></li>
</ul>
</dd>
</dl>
<p>Author: DY
Date: YYYY-MM-DD</p>
<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.sfft_ccf">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">sfft_ccf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ntmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#sfft_ccf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.sfft_ccf" title="Link to this definition"></a></dt>
<dd><p>Compute the correlation function between two signals using a serial FFT-based method.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>x (np.ndarray): First input signal of shape (n_coords, n_samples).
y (np.ndarray): Second input signal of shape (n_coords, n_samples).
ntmax (int, optional): Maximum number of time samples to retain.
center (bool, optional): If True, subtract the mean from each signal.
loop (bool, optional): If True, compute the correlation in a loop.
dtype (data-type, optional): Desired data type (default: x.dtype).</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: Correlation function array of shape (n_coords, n_coords, ntmax).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.pfft_ccf">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">pfft_ccf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ntmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#pfft_ccf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.pfft_ccf" title="Link to this definition"></a></dt>
<dd><p>Compute the correlation function using a parallel FFT-based method.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>x (np.ndarray): First input signal.
y (np.ndarray): Second input signal.
ntmax (int, optional): Maximum number of time samples to retain.
center (bool, optional): If True, subtract the mean.
dtype (data-type, optional): Desired data type.</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: Correlation function array with shape (n_coords, n_coords, ntmax).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.gfft_ccf">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">gfft_ccf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ntmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#gfft_ccf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.gfft_ccf" title="Link to this definition"></a></dt>
<dd><p>Compute the correlation function on the GPU using FFT.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>x (np.ndarray): First input signal.
y (np.ndarray): Second input signal.
ntmax (int, optional): Maximum number of time samples to retain.
center (bool, optional): If True, subtract the mean.
dtype (data-type, optional): Desired CuPy data type (default: inferred from x).</p>
</dd>
<dt>Returns:</dt><dd><p>cp.ndarray: The computed correlation function as a CuPy array.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.gfft_ccf_auto">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">gfft_ccf_auto</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ntmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer_c</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#gfft_ccf_auto"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.gfft_ccf_auto" title="Link to this definition"></a></dt>
<dd><p>Same as “gfft_ccf” but regulates GPU to CPU I/O based on the available GPU memory</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.fft_ccf">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">fft_ccf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'serial'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#fft_ccf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.fft_ccf" title="Link to this definition"></a></dt>
<dd><p>Unified wrapper for FFT-based correlation functions.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>args: Positional arguments for the chosen correlation function.
mode (str): Mode to use (‘serial’, ‘parallel’, or ‘gpu’).
kwargs: Additional keyword arguments.</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: The computed correlation function.</p>
</dd>
<dt>Raises:</dt><dd><p>ValueError: If an unsupported mode is specified.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.ccf">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">ccf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ntmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'parallel'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#ccf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.ccf" title="Link to this definition"></a></dt>
<dd><p>Compute the average cross-correlation function of two signals by segmenting them.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>xs (np.ndarray): First input signal of shape (n_coords, n_samples).
ys (np.ndarray): Second input signal of shape (n_coords, n_samples).
ntmax (int, optional): Maximum number of time samples per segment.
n (int, optional): Number of segments.
mode (str, optional): Mode (‘parallel’, ‘serial’, or ‘gpu’).
center (bool, optional): If True, mean-center the signals.
dtype (data-type, optional): Desired data type.</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: The averaged cross-correlation function.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.gfft_conv">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">gfft_conv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#gfft_conv"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.gfft_conv" title="Link to this definition"></a></dt>
<dd><p>Compute element-wise convolution between two signals on the GPU using FFT.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>x (np.ndarray): First input signal.
y (np.ndarray): Second input signal.
loop (bool, optional): If True, use a loop-based computation.
dtype (data-type, optional): Desired CuPy data type.</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: Convolution result as a NumPy array.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.sfft_cpsd">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">sfft_cpsd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ntmax=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype=&lt;class</span> <span class="pre">'numpy.float64'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#sfft_cpsd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.sfft_cpsd" title="Link to this definition"></a></dt>
<dd><p>Compute the Cross-Power Spectral Density (CPSD) between two signals using FFT.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>x (np.ndarray): First input signal.
y (np.ndarray): Second input signal.
ntmax (int, optional): Number of frequency bins to retain.
center (bool, optional): If True, mean-center the signals.
loop (bool, optional): If True, use loop-based computation.
dtype (data-type, optional): Desired data type.</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: The computed CPSD.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.covariance_matrix">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">covariance_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">positions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype=&lt;class</span> <span class="pre">'numpy.float32'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#covariance_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.covariance_matrix" title="Link to this definition"></a></dt>
<dd><p>Calculate the position-position covariance matrix from a set of positions.</p>
<p>The function centers the input positions by subtracting their mean and then
computes the covariance matrix using np.cov.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>positions (np.ndarray): Array of positions.
dtype (data-type, optional): Data type (default: np.float32).</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: The computed covariance matrix.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.dci">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">dci</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">perturbation_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asym</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#dci"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.dci" title="Link to this definition"></a></dt>
<dd><p>Calculate the Dynamic Coupling Index (DCI) matrix from a perturbation matrix.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>perturbation_matrix (np.ndarray): Input perturbation matrix.
asym (bool, optional): If True, return asymmetric DCI.</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: The computed DCI matrix.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.group_molecule_dci">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">group_molecule_dci</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">perturbation_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asym</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#group_molecule_dci"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.group_molecule_dci" title="Link to this definition"></a></dt>
<dd><p>Compute the DCI for specified groups of atoms relative to the entire molecule.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>perturbation_matrix (np.ndarray): The perturbation matrix.
groups (list of list, optional): List of groups of atom indices. Defaults to [[]].
asym (bool, optional): If True, adjust for asymmetry.</p>
</dd>
<dt>Returns:</dt><dd><p>list: List of DCI values for each group.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.group_group_dci">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">group_group_dci</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">perturbation_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asym</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#group_group_dci"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.group_group_dci" title="Link to this definition"></a></dt>
<dd><p>Calculate the DCI matrix between different groups of atoms.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>perturbation_matrix (np.ndarray): The perturbation matrix.
groups (list of list, optional): List of groups (each a list of indices). Defaults to [[]].
asym (bool, optional): If True, compute asymmetric DCI.</p>
</dd>
<dt>Returns:</dt><dd><p>list: A nested list representing the DCI matrix between groups.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.inverse_sparse_matrix_cpu">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">inverse_sparse_matrix_cpu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k_singular</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#inverse_sparse_matrix_cpu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.inverse_sparse_matrix_cpu" title="Link to this definition"></a></dt>
<dd><p>Compute the inverse of a sparse matrix on the CPU using eigen-decomposition.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>matrix (np.ndarray): Input matrix.
k_singular (int, optional): Number of smallest eigenvalues to zero out.
n_modes (int, optional): Number of eigenmodes to compute.
dtype: Desired data type (default: matrix.dtype).
kwargs: Additional arguments for eigensolver.</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: The computed inverse matrix.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.inverse_matrix_cpu">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">inverse_matrix_cpu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k_singular</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#inverse_matrix_cpu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.inverse_matrix_cpu" title="Link to this definition"></a></dt>
<dd><p>Compute the inverse of a matrix on the CPU using dense eigen-decomposition.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>matrix (np.ndarray): Input matrix.
k_singular (int, optional): Number of smallest eigenvalues to zero out.
n_modes (int, optional): Number of eigenmodes to consider.
dtype: Desired data type (default: matrix.dtype).
kwargs: Additional arguments for the solver.</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: The inverse matrix computed on the CPU.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.inverse_sparse_matrix_gpu">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">inverse_sparse_matrix_gpu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k_singular</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#inverse_sparse_matrix_gpu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.inverse_sparse_matrix_gpu" title="Link to this definition"></a></dt>
<dd><p>Compute the inverse of a sparse matrix on the GPU using eigen-decomposition.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>matrix (np.ndarray): Input matrix.
k_singular (int, optional): Number of smallest eigenvalues to zero out.
n_modes (int, optional): Number of eigenmodes to compute.
dtype: Desired CuPy data type (default: matrix.dtype).
kwargs: Additional arguments for the GPU eigensolver.</p>
</dd>
<dt>Returns:</dt><dd><p>cp.ndarray: The inverse matrix computed on the GPU.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.inverse_matrix_gpu">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">inverse_matrix_gpu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k_singular</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#inverse_matrix_gpu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.inverse_matrix_gpu" title="Link to this definition"></a></dt>
<dd><p>Compute the inverse of a matrix on the GPU using dense eigen-decomposition.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>matrix (np.ndarray): Input matrix.
k_singular (int, optional): Number of smallest eigenvalues to zero out.
n_modes (int, optional): Number of eigenmodes to consider.
dtype: Desired CuPy data type (default: matrix.dtype).
kwargs: Additional arguments for the solver.</p>
</dd>
<dt>Returns:</dt><dd><p>cp.ndarray: The inverse matrix computed on the GPU.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reforge.rfgmath.rpymath.percentile">
<span class="sig-prename descclassname"><span class="pre">reforge.rfgmath.rpymath.</span></span><span class="sig-name descname"><span class="pre">percentile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/reforge/rfgmath/rpymath.html#percentile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#reforge.rfgmath.rpymath.percentile" title="Link to this definition"></a></dt>
<dd><p>Compute the empirical percentile rank for each element in an array.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><p>x (np.ndarray): Input array.</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: Array of percentile ranks.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-reforge.rfgmath">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-reforge.rfgmath" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="reforge.mdsystem.html" class="btn btn-neutral float-left" title="reforge.mdsystem package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Danis Yangaliev.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>